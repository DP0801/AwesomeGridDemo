@{
    ViewBag.Title = "Grid Custom Formatting";
}
<h1>Grid Custom Formatting</h1>
@*begin*@
@Html.Awe().InitPopup().Name("details").Url(Url.Action("Details", "GridDemo")).Mod(o => o.Dropdown()).Modal()
@{
    var detailsBtnFormat = Html.Awe().Button()
            .Text("details")
            .CssClass("o-pad")
            .OnClick(Html.Awe().OpenPopup("details")
            .Params(new { id = ".(Id)" }))
            .ToString();

    var linkFormat = "<a href='" + Url.Action("OpenDetails", "GridDemo", new { id = ".(Id)" }) + "'>open</a>";
}

@(Html.Awe().Grid("CustomFormatGrid")
        .Url(Url.Action("CustomFormatGrid", "GridDemo"))
        .Mod(o => o.ColumnsSelector())
        .Resizable()
        .Reorderable()
        .Height(350)
        .RowClassClientFormat(".(RowClass)") // setting row class using a value from the rowModel
        .Columns(
            new Column { Bind = "Person", HeaderCssClass = "boldh" }, // default format rowModel.Bind
            new Column { ClientFormat = "had .(Food) at .(Location)", Header = "Description", CssClass = "bluev" }, // custom format using .(Prop)
            new Column { Prop = "Location", Header = "Location"}, // equivalent to ClientFormat = ".(Location)"
            new Column { Bind = "Price", ClientFormatFunc = "formatPrice", Width = 100 }, // using js function(rowModel, col.Bind) to get the cell content
            new Column { Bind = "Date", CssClass = "bgdate" },
            new Column { Bind = "Organic", ClientFormatFunc = "toggle", Width = 90 },
            new Column { ClientFormat = linkFormat, Width = 90, CssClass = "center" }, // link to OpenDetails page
            new Column { ClientFormatFunc = "condButton", Width = 90, CssClass = "center" }, // link button when Organic = true
            new Column { ClientFormatFunc = "condBtnPopup", Width = 90 }, // popup btn when Organic = true
            new Column { ClientFormat = detailsBtnFormat, Width = 90 })) @*details popup*@

@*note Column.Bind is not required, but without it you can't Sort/Group by that column*@

@{
    var orgFormat = Html.Awe().CheckBox("org")
                .Prefix(".(Id)")
                .Otoggl(cssClass: ".(Chked)")
                .Svalue(".(Organic)")
                .SyncScript()
                .Enabled(false)
                .ToString();
}

<script type="text/javascript">
    function condBtnPopup(lunch) {
        if (lunch.Organic) {
            return '<button type="button" class="awe-btn o-pad" onclick="awe.open(\'details\', {params:{ id: ' + lunch.Id + ' }}, event)">details</button>';
            // event param indicates the opener target
        }

        return '';
    }

    function condButton(lunch) {
        if (lunch.Organic) {
            return '<button type="button" class="awe-btn o-pad" onclick="openDetails(' + lunch.Id + ')">open</button>';
        }

        return '';
    }

    function openDetails(id) {
        location.href = '@Url.Action("OpenDetails", "GridDemo")?id=' + id;
    }

    function toggle(lunch) {
        var str = @Html.Raw(DemoUtils.Encode(orgFormat));
        var chkd = lunch.Organic ? 'o-chked' : '';

        str = str.split('.(Id)').join(lunch.Id)
            .split('.(Organic)').join(lunch.Organic)
            .split('.(Chked)').join(chkd);
        return str;
    }

    function formatPrice(lunch, prop) {
        var color = 'navy';
        var price = lunch[prop];
        if (price < 20) color = 'green';
        if (price > 50) color = 'red';
        return "<div style='color:" + color + ";text-width:bold;'>" + price + " &pound; </div>";
    }
</script>
<style>
    .date1 .bgdate {
        background: #efd2e8;
    }

    .boldh .awe-col, .awe-header td.boldh {
        color: #cc00ff;
    }

    .bluev {
        color: blueviolet;
    }

    .pinkb {
        background: pink !important;
        color: black;
    }

    .greenb {
        background: #f0f9f7 !important;
        color: black;
    }

    .awe-grid .pinkb a, .awe-grid .greenb a {
        color: blue;
    }
</style>
@*end*@
<br />

@(Html.Awe().Tabs().Add("description",
    @<text>Cell values can be evaluated on the client side using templates and js functions or on the server side using Map and setting a custom value (as shown here for the Date column).<br/>
        The group header value can also be set on the server side, same applies for the footer.<br />
        <br />
        <ul>
            <li>
                <code>Column.ClientFormat</code> - Client format for the column defined as a string using <code>.(ModelPropertyName)</code> for including values of the row model.
            </li>
            <li>
                <code>Column.ClientFormatFunc</code> - Defines the Name of a javascript function that will receive as a parameter the rowModel of the grid row and must return a string
                which will be used a value for the cell. The result of the javascript function will not be encoded.
            </li>
            <li>
                <code>RowClassClientFormat</code> - used to set the class attribute for grid rows
            </li>
        </ul></text>, "expl")
          .Add("view", Html.Source("GridDemo/CustomFormat.cshtml"))
          .Add("controller", Html.Csource("Demos/Grid/GridDemoController.cs", "format"))
          .Add("popup view", Html.Source("GridDemo/Details.cshtml"))
          .Add("open view", Html.Source("GridDemo/OpenDetails.cshtml")))